name: YouTube Playlist Auto Generator

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"    # প্রতি ৬ ঘন্টায় রান হবে (ইচ্ছেমত বদলানো যায়)

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: |
        pip install yt-dlp
        pip install requests

    # ----------------------------
    # Decode Base64 → cookies.txt
    # ----------------------------
    - name: Decode cookies file
      run: |
        echo "${{ secrets.COOKIES_BASE64 }}" | base64 --decode > cookies.txt
        echo "First 5 lines of cookies.txt"
        head -n 5 cookies.txt

    # ----------------------------
    # Run your Python YouTube script
    # ----------------------------
    - name: Run Python script
      run: |
        python main.py

    # ----------------------------
    # Commit & Push generated playlist
    # ----------------------------
    - name: Commit playlist
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add YT_playlist.m3u
        git commit -m "Auto Updated Playlist $(date)" || echo "No changes"
        git push
